{
  "title": "Jarvis TTS Synchronization Flow Analysis",
  "description": "Timeline showing the synchronization issue between animation and Edge TTS audio",
  "timestamp": "2025-08-25T09:30:00Z",
  "flows": {
    "system_tts": {
      "name": "System TTS (Working Perfect)",
      "timeline": [
        {
          "time": 0,
          "event": "User stops talking",
          "component": "Frontend",
          "status": "idle"
        },
        {
          "time": 500,
          "event": "API Response arrives",
          "component": "Frontend",
          "status": "processing_complete"
        },
        {
          "time": 500,
          "event": "Animation starts",
          "component": "Frontend Animation",
          "status": "speaking"
        },
        {
          "time": 600,
          "event": "Browser TTS starts",
          "component": "System Audio",
          "status": "speaking",
          "note": "Perfect sync - 100ms delay"
        },
        {
          "time": 5000,
          "event": "TTS & Animation end",
          "component": "Both",
          "status": "idle"
        }
      ]
    },
    "edge_tts_current": {
      "name": "Edge TTS (Current Problem)",
      "timeline": [
        {
          "time": 0,
          "event": "User stops talking",
          "component": "Frontend",
          "status": "idle"
        },
        {
          "time": 1000,
          "event": "API Response arrives",
          "component": "Frontend",
          "status": "processing_complete"
        },
        {
          "time": 1000,
          "event": "TTS Request sent to server",
          "component": "Frontend â†’ Server",
          "status": "tts_requesting"
        },
        {
          "time": 1000,
          "event": "ðŸŽ¤ Edge TTS generation starts",
          "component": "Server",
          "status": "generating",
          "note": "File generation phase - 4 seconds"
        },
        {
          "time": 1800,
          "event": "ðŸŽ¬ Animation starts",
          "component": "Frontend Animation",
          "status": "speaking",
          "note": "TOO EARLY! Audio not ready yet"
        },
        {
          "time": 5000,
          "event": "ðŸŽµ Audio generation complete",
          "component": "Server",
          "status": "generation_complete"
        },
        {
          "time": 5000,
          "event": "ðŸ”Š afplay starts audio",
          "component": "System Audio",
          "status": "speaking",
          "note": "PROBLEM: Animation started 3200ms ago!"
        },
        {
          "time": 10000,
          "event": "ðŸ”š Audio playback finished",
          "component": "System Audio",
          "status": "idle"
        },
        {
          "time": 10300,
          "event": "Animation stops",
          "component": "Frontend Animation",
          "status": "idle"
        }
      ]
    }
  },
  "problem_analysis": {
    "sync_gap": "3200ms",
    "description": "Animation starts 800ms after TTS request, but actual audio starts 4000ms after TTS request",
    "root_cause": "Edge TTS has two phases: generation (4s) + playback, but animation only waits for request acknowledgment"
  },
  "metrics": {
    "edge_tts_generation_time": "4000ms",
    "current_animation_delay": "800ms",
    "required_animation_delay": "4000ms",
    "sync_accuracy_system_tts": "95%",
    "sync_accuracy_edge_tts": "30%"
  },
  "solution_options": [
    {
      "name": "WebSocket Real-time Sync",
      "description": "Server sends WebSocket message when audio actually starts",
      "complexity": "High",
      "accuracy": "99%",
      "implementation": "Add WebSocket, emit 'audio_started' event from afplay"
    },
    {
      "name": "Dynamic Delay Calculation",
      "description": "Calculate delay based on text length and voice type",
      "complexity": "Medium", 
      "accuracy": "80%",
      "implementation": "Estimate generation time: (text_length * voice_multiplier)"
    },
    {
      "name": "Server-side Animation Control",
      "description": "Server controls animation timing via API calls",
      "complexity": "Medium",
      "accuracy": "90%",
      "implementation": "Server calls frontend when audio starts"
    }
  ]
}